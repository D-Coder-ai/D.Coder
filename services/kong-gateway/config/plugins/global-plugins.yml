# Global Kong Plugins
# Applied to all routes for observability and request tracking
# All plugins are Kong OSS (no Enterprise dependencies)

plugins:
  # Correlation ID - Add unique request ID for distributed tracing
  - name: correlation-id
    config:
      header_name: X-Request-Id
      generator: uuid
      echo_downstream: true

  # Prometheus - Expose metrics for monitoring
  - name: prometheus
    config:
      per_consumer: true
      status_code_metrics: true
      latency_metrics: true
      bandwidth_metrics: true
      upstream_health_metrics: true

  # Request ID - Ensure X-Request-Id propagation
  - name: request-id
    config:
      header_name: X-Request-Id
      echo_downstream: true
      generator: uuid

  # CORS - Allow cross-origin requests from client apps
  - name: cors
    config:
      origins:
        - "http://localhost:3000"   # Open WebUI Doc Chat
        - "http://localhost:3003"   # Open WebUI Code Chat
        - "http://localhost:3005"   # Admin Dashboard
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
      headers:
        - Accept
        - Authorization
        - Content-Type
        - X-Request-Id
        - X-Tenant-Id
        - X-Platform-Id
        - X-User-Id
        - X-Trace-Id
        - Idempotency-Key
      exposed_headers:
        - X-Request-Id
        - X-RateLimit-Limit
        - X-RateLimit-Remaining
        - X-RateLimit-Reset
      credentials: true
      max_age: 3600
      preflight_continue: false
